CREATE TABLE .[USER_DETAILS]
(
    [USER_DETAIL_ID] [BIGINT] IDENTITY(1, 1),
	[ROLE_ID] [BIGINT] NOT NULL,
    [USERNAME] [NVARCHAR](128) NOT NULL,
	[TITLE] [NVARCHAR](32) NULL,
	[FIRST_NAME] [NVARCHAR](256) NOT NULL,
	[MIDDLE_NAME] [NVARCHAR](256) NULL,
	[LAST_NAME] [NVARCHAR](256) NULL,
    [PRIMARY_EMAIL] [NVARCHAR](256) NOT NULL,
	[ALTERNATE_EMAIL] [NVARCHAR](256) NULL,
	[PRIMARY_PHONE] [NVARCHAR](256) NOT NULL,
    [ALTERNATE_PHONE] [NVARCHAR](256) NULL,
	[IS_ACTIVE] [BIT] NULL CONSTRAINT [DF_USER_DETAILS_IS_ACTIVE] DEFAULT ((1)),
	[CREATED_BY] [BIGINT] NULL,
	[CREATED_ON] [DATETIME] NULL,
	[UPDATED_BY] [BIGINT] NULL,
	[UPDATED_ON] [DATETIME] NULL,
	[DELETED_BY] [BIGINT] NULL,
	[DELETED_ON] [DATETIME] NULL,
	[ROW_VERSION] [ROWVERSION] NOT NULL
)
ALTER TABLE .[USER_DETAILS] ADD CONSTRAINT [PK_USER_DETAILS_USER_DETAIL_ID] PRIMARY KEY CLUSTERED  ([USER_DETAIL_ID]) WITH (FILLFACTOR=80) ON [PRIMARY]
GO
ALTER TABLE .[USER_DETAILS] ADD CONSTRAINT [UX_USER_DETAILS_USERNAME] UNIQUE ([USERNAME])
GO
ALTER TABLE .[USER_DETAILS] ADD CONSTRAINT [FK_USER_DETAILS_ROLE_ID] FOREIGN KEY ([ROLE_ID]) REFERENCES .[ROLE] ([ROLE_ID]) NOT FOR REPLICATION
GO



CREATE TABLE [].[BOOKING_DETAILS]
(
    [BOOKING_DETAIL_ID] [BIGINT] IDENTITY(1, 1),
    [BOOKING_REFERENCE] [NVARCHAR](20) NOT NULL,
    [USER_ID] [BIGINT] NOT NULL,
    [BOOKING_TYPE_ID] [INT] NOT NULL,
	[FROM_AIRPORT_ID] [BIGINT] NULL,
	[TO_AIRPORT_ID] [BIGINT] NULL,
    [TRIP_TYPE_ID] [INT] NOT NULL,
	[NO_OF_MEAL] [INT] NULL, -- meal type
    [BOOKING_STATUS_ID] [INT] NOT NULL,
    [BOOKING_DATE] [DATETIME] NOT NULL,
    [TOTAL_AMOUNT] [DECIMAL](19, 4) NOT NULL,
	[REFUND_AMOUNT] [DECIMAL](19, 4) NOT NULL,
    [CURRENCY_CODE] [CHAR](5) NOT NULL CONSTRAINT [DF_BOOKING_CURRENCY_CODE] DEFAULT ('INR'),
    [NOTES] [NVARCHAR](1024) NULL,
    [IS_ACTIVE] [BIT] NULL CONSTRAINT [DF_BOOKING_IS_ACTIVE] DEFAULT ((1)),
    [CREATED_BY] [BIGINT] NULL,
    [CREATED_ON] [DATETIME] NULL,
    [UPDATED_BY] [BIGINT] NULL,
    [UPDATED_ON] [DATETIME] NULL,
    [DELETED_BY] [BIGINT] NULL,
    [DELETED_ON] [DATETIME] NULL,
    [ROW_VERSION] [ROWVERSION] NOT NULL
);
ALTER TABLE [].[BOOKING_DETAILS]
ADD CONSTRAINT [PK_BOOKING_DETAILS_BOOKING_DETAIL_ID]
    PRIMARY KEY CLUSTERED ([BOOKING_DETAIL_ID])
    WITH(FILLFACTOR = 80)ON [PRIMARY];
GO
ALTER TABLE [].[BOOKING_DETAILS]
ADD CONSTRAINT [FK_BOOKING_DETAILS_USER_ID]
    FOREIGN KEY ([USER_ID])
    REFERENCES [].[USER_DETAILS] ([USER_ID]) NOT FOR REPLICATION;
GO
ALTER TABLE [].[BOOKING_DETAILS]
ADD CONSTRAINT [FK_BOOKING_DETAILS_BOOKING_TYPE_ID]
    FOREIGN KEY ([BOOKING_TYPE_ID])
    REFERENCES [].[CMN_MA_BOOKING_TYPE] ([BOOKING_TYPE_ID]) NOT FOR REPLICATION;
GO
ALTER TABLE [].[BOOKING_DETAILS]
ADD CONSTRAINT [FK_BOOKING_DETAILS_TRIP_TYPE_ID]
    FOREIGN KEY ([TRIP_TYPE_ID])
    REFERENCES [].[FL_MA_TRIP_TYPE] ([TRIP_TYPE_ID]) NOT FOR REPLICATION;
GO
ALTER TABLE [].[BOOKING_DETAILS]
ADD CONSTRAINT [FK_BOOKING_DETAILS_BOOKING_STATUS_ID]
    FOREIGN KEY ([BOOKING_STATUS_ID])
    REFERENCES [].[CMN_MA_BOOKING_STATUS] ([BOOKING_STATUS_ID]) NOT FOR REPLICATION;
GO


CREATE TABLE [].[PAYMENT_DETAILS]
(
    [PAYMENT_DETAIL_ID] BIGINT IDENTITY(1, 1),
    [BOOKING_DETAIL_ID] BIGINT NOT NULL,
    [PAYMENT_METHOD_ID] INT NOT NULL,
    [PAYMENT_STATUS_ID] INT NOT NULL,
    [TOTAL_AMOUNT] DECIMAL(19, 4) NOT NULL,
	[BASE_AMOUNT] DECIMAL(19, 4) NULL,
	[ADDITIONAL_AMOUNT] DECIMAL(19, 4) NULL,
	[DISCOUNT_AMOUNT] DECIMAL(19, 4) NULL,
	[TAX_AMOUNT] DECIMAL(19, 4) NULL,	
	[ROUNDED_AMOUNT] DECIMAL(19, 4) NULL,
	[REFUND_AMOUNT] DECIMAL(19, 4) NULL,
    [CURRENCY_CODE] CHAR(3) NOT NULL CONSTRAINT [DF_PAYMENT_DETAILS_CURRENCY_CODE] DEFAULT ('INR'),
    [GATEWAYTXNID] NVARCHAR(100) NULL,
    [GATEWAYAUTHCODE] NVARCHAR(50) NULL,
    [INITIATED_ON] DATETIME NOT NULL,
    [COMPLETED_ON] DATETIME NULL,
    [IS_ACTIVE] [BIT] NULL CONSTRAINT [DF_PAYMENT_DETAILS_IS_ACTIVE] DEFAULT ((1)),
    [CREATED_BY] [BIGINT] NULL,
    [CREATED_ON] [DATETIME] NULL,
    [UPDATED_BY] [BIGINT] NULL,
    [UPDATED_ON] [DATETIME] NULL,
    [DELETED_BY] [BIGINT] NULL,
    [DELETED_ON] [DATETIME] NULL,
    [ROW_VERSION] [ROWVERSION] NOT NULL
);
ALTER TABLE [].[PAYMENT_DETAILS]
ADD CONSTRAINT [PK_PAYMENT_DETAILS_PAYMENT_DETAIL_ID]
    PRIMARY KEY CLUSTERED ([PAYMENT_DETAIL_ID])
    WITH(FILLFACTOR = 80)ON [PRIMARY];
GO
ALTER TABLE [].[PAYMENT_DETAILS]
ADD CONSTRAINT [FK_PAYMENT_DETAILS_BOOKING_DETAIL_ID]
    FOREIGN KEY ([BOOKING_DETAIL_ID])
    REFERENCES [].[BOOKING_DETAILS] ([BOOKING_DETAIL_ID]) NOT FOR REPLICATION;
GO
ALTER TABLE [].[PAYMENT_DETAILS]
ADD CONSTRAINT [FK_PAYMENT_DETAILS_PAYMENT_METHOD_ID]
    FOREIGN KEY ([PAYMENT_METHOD_ID])
    REFERENCES [].[CMN_MA_PAYMENT_METHOD] ([PAYMENT_METHOD_ID]) NOT FOR REPLICATION;
GO
ALTER TABLE [].[PAYMENT_DETAILS]
ADD CONSTRAINT [FK_PAYMENT_DETAILS_PAYMENT_STATUS_ID]
    FOREIGN KEY ([PAYMENT_STATUS_ID])
    REFERENCES [].[CMN_MA_PAYMENT_STATUS] ([PAYMENT_STATUS_ID]) NOT FOR REPLICATION;
GO